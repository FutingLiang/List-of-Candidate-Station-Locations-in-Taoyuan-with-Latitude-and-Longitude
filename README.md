# 🗺️ 桃園公車站位地圖視覺化工具

## 📊 專案簡介
這是一個互動式的公車站位地圖視覺化工具，專為桃園市公車站位資料分析設計。支援 Excel 檔案上傳，提供真實地圖背景和多種視覺化功能，幫助使用者直觀地分析公車站位分布和載客量資料。

## ✨ 主要功能

### 📂 資料處理
- **Excel 檔案上傳** - 支援 .xlsx/.xls 格式
- **智能欄位匹配** - 自動識別中英文欄位名稱
- **資料驗證** - 檢查經緯度和載客量資料完整性
- **示範資料** - 內建桃園市公車站位示範資料

### 🗺️ 地圖視覺化
- **雙模式地圖** - Leaflet + OpenStreetMap 真實地圖 / Canvas 快速模式
- **動態標記** - 根據載客量顯示不同顏色和大小的站點標記
- **互動功能** - 點擊標記查看詳細站點資訊
- **地圖控制** - 縮放、平移、重置視圖、自動調整範圍

### 📊 資料分析
- **即時統計** - 總站點數、平均載客量、最高載客量、總路線數
- **多重篩選** - 行政區、載客量範圍、路線數篩選
- **圖例說明** - 清楚的載客量分級顯示
- **資料匯出** - 篩選後資料可匯出為 Excel 檔案

## 🚀 快速開始

### 1. 開啟工具
直接在瀏覽器中開啟 `桃園地圖1.html` 檔案即可使用。

### 2. 上傳資料
- 點擊上傳區域或拖拽 Excel 檔案 (.xlsx/.xls)
- 或點擊「載入示範資料」查看範例

### 3. 查看地圖
- 地圖會自動顯示站點分布
- 不同顏色代表不同載客量級別
- 點擊標記查看詳細資訊

## 📋 Excel 檔案格式要求

您的 Excel 檔案應包含以下欄位（支援中英文名稱）：

| 必要欄位 | 中文名稱 | 英文名稱 | 說明 |
|---------|---------|---------|------|
| 站名 | 站位名稱、站名 | name, station | 公車站位名稱 |
| 行政區 | 行政區、區域 | district, area | 所屬行政區域 |
| 經度 | 經度 | longitude, lng, lon | WGS84 經度座標 |
| 緯度 | 緯度 | latitude, lat | WGS84 緯度座標 |
| 載客量 | 上車量、下車量、總載客量 | boarding, alighting, total | 日載客量數據 |

### 範例資料格式
```
排名 | 站位名稱 | 行政區 | 上車量 | 下車量 | 總載客量 | 經度 | 緯度 | 路線數
1 | 中壢客運中壢總站 | 中壢區 | 3100 | 2345 | 5445 | 121.22404 | 24.95317 | 12
2 | 桃園長庚轉運站 | 龜山區 | 1704 | 1782 | 3486 | 121.36714 | 25.06332 | 20
```

## 🎯 載客量分級說明

- 🔴 **高載客量站點** - 超過 3000 人次/日
- 🟡 **中載客量站點** - 1000-3000 人次/日  
- 🟢 **低載客量站點** - 少於 1000 人次/日

## ⚡ 效能優化

### 地圖載入模式
1. **標準模式** - 使用 Leaflet + OpenStreetMap，提供真實地圖背景
2. **快速模式** - 純 Canvas 繪製，載入速度更快，適合網路較慢時使用

### 切換快速模式
- 如果地圖載入超過 3 秒，會自動顯示「切換到快速模式」按鈕
- 點擊按鈕可立即切換到離線 Canvas 模式

## 🛠️ 技術架構

### 前端技術
- **HTML5 + CSS3** - 響應式網頁設計
- **JavaScript ES6** - 現代化 JavaScript 開發
- **Leaflet.js** - 開源地圖庫
- **XLSX.js** - Excel 檔案解析

### 地圖服務
- **OpenStreetMap** - 免費開源地圖資料
- **CartoDB** - 高效能地圖瓦片服務
- **Canvas 2D** - 備用離線繪圖模式

### 特色功能
- **無需 API Key** - 完全免費使用
- **離線支援** - Canvas 模式可在無網路環境下運作
- **智能欄位匹配** - 自動識別各種欄位名稱格式
- **即時篩選** - 動態更新地圖和統計資料

## 📱 瀏覽器支援

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 11+
- ✅ Edge 79+

## 🔧 故障排除

### 地圖無法顯示
1. 檢查網路連線
2. 點擊「切換到快速模式」
3. 重新整理頁面

### Excel 檔案無法上傳
1. 確認檔案格式為 .xlsx 或 .xls
2. 檢查檔案是否包含必要的經緯度欄位
3. 確認資料格式正確

### 站點無法顯示
1. 檢查經緯度資料是否為有效數值
2. 確認座標範圍在桃園市附近
3. 檢查是否有篩選條件過於嚴格

## 📄 授權資訊

本專案使用以下開源技術：
- [Leaflet](https://leafletjs.com/) - BSD 2-Clause License
- [XLSX.js](https://github.com/SheetJS/sheetjs) - Apache 2.0 License
- [OpenStreetMap](https://www.openstreetmap.org/) - ODbL License

## 👨‍💻 開發資訊

**檔案名稱**: 桃園地圖1.html  
**版本**: Excel 版本  
**最後更新**: 2025-08-14  
**開發環境**: HTML5 + JavaScript ES6
